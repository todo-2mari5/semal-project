{% extends 'base.html' %}

{% block content %}

    <div class="post-wrapper">
        <div class="switch">
            <label class="tgl-btn" for="toggle1">
                <input type="checkbox" id="toggle1" class="tgl">
                <span class="tgl-content"></span>
                <span class="tgl-circle"></span>
            </label>
            <p class="archive"><a href="{% url 'myapp:post_archive' %}">â†’Archive</a></p>

        </div>
        <div class="container post-contents">
            <div class="row" id="posts">
                {% for post in posts %}
                <div class="col-10 col-md-6 col-lg-4 post-card">
                    <a href="{% url 'myapp:post_detail' pk=post.pk %}">
                        <div class="post-col">
                            <div class="photo-wrapper">
                                <img src="{{ post.thumb.url }}" class="photo-prv">
                            </div>
                            <div class="text-wrapper">
                                <h1>{{ post.title }}</h1>
                                <p class="date">{{ post.event_date|date:"Y/m/d" }}</p>
                            </div>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

{% endblock %}

{% block extrajs %}
<script>
    let posts = document.getElementById('posts');
    let boxies = posts.getElementsByClassName('post-card');
    let post_list = Array.prototype.slice.call(boxies);

    function compare(prop){
      return function(a,b){
        if( a.getElementsByClassName(prop)[0].textContent > b.getElementsByClassName(prop)[0].textContent){
            return 1;
        }else if( a.getElementsByClassName(prop)[0].textContent < b.getElementsByClassName(prop)[0].textContent ){
            return -1;
        }
        return 0;
      }
    }

    let sorted_list = post_list.slice().sort(compare("date"));
    let lists = [sorted_list, post_list];

    $('#toggle1').click(function(){
        let target_list = lists[0];
        $.when(
            $('#posts').fadeOut(150)
        ).done(function(){
            for (let i=0; i<target_list.length;i++){
                $('#posts').append(target_list[i]).hide().fadeIn(150);
            };
        });
        lists = lists.reverse();
    });
</script>

{% endblock %}